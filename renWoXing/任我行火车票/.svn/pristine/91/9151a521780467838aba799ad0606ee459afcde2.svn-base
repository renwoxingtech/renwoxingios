//
//  NormalOrderVc.m
//  CommonProject
//
//  Created by mac on 2017/2/14.
//  Copyright © 2017年 mac. All rights reserved.
//

#import "NormalOrderVc.h"

@interface NormalOrderVc ()
{
    NSInteger cur_tag;
    NSInteger cur_index;
    

}
@end

@implementation OrderCell


@end
@implementation QPOrderCell



@end

@implementation NormalOrderVc

- (void)viewDidLoad {
    [super viewDidLoad];


    self.title = @"订单";
    for (int i=0; i<2; i++) {
        NSMutableArray *a = [NSMutableArray array];
        for (int j=0; j<3; j++) {
            NSMutableArray *b = [NSMutableArray array];
            [a addObject:b];
            
//            [b addObject:[[OrderData alloc]init]];
        }
        [self.mainDataSource addObject:a];
    }
    
    
    self.tipView.hidden = YES;
    if (self.isQpdd) {
        self.taggbgView.hidden = YES;
        self.tipView.hidden = NO;
        self.tipView.top = 64+45;
        
    }
    [self get12306dataa];
    
}

#pragma mark - 获取数据
-(void)get12306dataa{
    NSDictionary *par = @{@"UToken":UToken};
    [[Httprequest shareRequest] postObjectByParameters:[self getparametersWithDic:par] andUrl:@"Action/buyListOnline/" showLoading:YES showMsg:YES isFullUrk:NO andComplain:^(id obj) {
        if ([obj[@"code"] integerValue] == 1) {
            NSMutableArray *arr = [OrderData mj_objectArrayWithKeyValuesArray:obj[@"data"]];
            NSMutableArray *arr2 = self.mainDataSource[1][0];
            
            [arr2 addObjectsFromArray:arr];
            [self.mainTableView reloadData];
        }

    } andError:^(id error) {
 
    }];   

}
- (IBAction)tagclick:(UIButton *)sender {
    [UIView animateWithDuration:0.3 animations:^{
        self.tagbggo.centerX = sender.centerX;
        
    }];

    
    if ([sender isEqual:self.renxingddbtn]) {
        cur_tag = 0;
    }else{
        cur_tag = 1;
    }
    [self.mainTableView reloadData];
}
- (IBAction)titlebtnclick:(UIButton *)sender {
    [UIView animateWithDuration:0.3 animations:^{
        
        self.titlebggo.centerX = sender.centerX;
        
    }];
    
    
    [self.qbdd setTitleColor:[UIColor darkGrayColor] forState:UIControlStateNormal];
    [self.yzfdd setTitleColor:[UIColor darkGrayColor] forState:UIControlStateNormal];
    [self.wzfdd setTitleColor:[UIColor darkGrayColor] forState:UIControlStateNormal];

    [sender setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];

    if ([sender isEqual:self.qbdd]) {
        cur_index = 0;
    }else if ([sender isEqual:self.yzfdd]) {
        cur_index = 1;
    }else if ([sender isEqual:self.wzfdd]) {
        cur_index = 2;
    }    
    [self.mainTableView reloadData];

}
-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    if (_isQpdd) {
        return 275;
    }
    return 140;
}
-(CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{
    return 10;
}
-(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    if (_isQpdd) {
        return 0;
    }
    if (cur_tag<self.mainDataSource.count) {
        
        NSArray *a  = self.mainDataSource[cur_tag];
        NSArray *b  = a[cur_index];
        return b.count;
    }
    return 0;
}
-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    //抢票订单相关
    if (self.isQpdd) {
        QPOrderCell *cell = [tableView dequeueReusableCellWithIdentifier:@"qpordercell"];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;

        cell.qpjieguo.layer.cornerRadius = 4;
        cell.qpxinxi.layer.masksToBounds = YES;
        
        return cell;
        
    }else{
        OrderCell *cell = [tableView dequeueReusableCellWithIdentifier:@"ordercell"];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        
        @try {
            NSArray *a  = self.mainDataSource[cur_tag];
            NSArray *b  = a[cur_index];
            OrderData *data = b[indexPath.row];
            cell.checi.text = data.checi;
            
            NSMutableString *ss2 = [NSMutableString stringWithString:[data.train_date substringFromIndex:4]];
      
            [ss2 insertString:@"月" atIndex:2];
            [ss2 insertString:@"日" atIndex:5];
            NSString *fache =  [NSString stringWithFormat:@"%@ %@开",ss2,data.start_time] ;
            cell.shijian.text = fache;
            
            cell.chufadi.text = data.from_station_name;
            cell.mididdi.text = data.to_station_name;
            NSString *chengke = @"";
            for (NSDictionary *pas in data.passengers) {
                chengke = [chengke stringByAppendingString:[NSString stringWithFormat:@"%@、",pas[@"passengersename"]]];
                
            }
            if (chengke.length>2) {
                chengke = [chengke substringToIndex:chengke.length-1];
                chengke = [chengke stringByAppendingString:[NSString stringWithFormat:@"共%lu人",(unsigned long)data.passengers.count]];
                           
            }
            cell.chengke.text = chengke;
            
            
        } @catch (NSException *exception) {
            
        } @finally {
            
        }
        
        
        
        cell.quxiaobtn.hidden = YES;
        cell.zfbtn.hidden = YES;
        return cell;

    }
}


@end
