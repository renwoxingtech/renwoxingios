//
//  BaseViewController.m
//  CommonProject
//
//  Created by mac on 2017/1/4.
//  Copyright © 2017年 mac. All rights reserved.
//

#import "BaseViewController.h"


@interface BaseViewController ()

@end

@implementation BaseViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    __weak typeof(self) weakSelf = self;
    
    
    
    self.mainTableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{
        [weakSelf refreshHeaderData];
        
    }];
    self.mainTableView.tableFooterView = [[UIView alloc]init];
    
    self.page = 1;
    //设置返回按钮的标题
    UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@"  " style:UIBarButtonItemStylePlain target:nil action: nil];
    [self.navigationItem setBackBarButtonItem:backButton];
    
    
    self.automaticallyAdjustsScrollViewInsets = NO;
    
    self.bgScrollView = [[UIScrollView alloc]initWithFrame:CGRectMake(0, 0, SWIDTH, SHEIGHT)];
    //子控制器 需要时再添加
    //    [self.view addSubview:self.bgScrollView];
    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(endE:)];
    __block BOOL hace = NO;
    
    [self.view.subviews enumerateObjectsUsingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if ([obj isKindOfClass:[UITableView class]]) {
            hace = YES;
        }
    }];
    if (!hace) {
        
        [self.view addGestureRecognizer:tap];
    }
    
    [self.view layoutIfNeeded];
    
    
    [self setNavBar];
    
    self.navigationController.interactivePopGestureRecognizer.delegate = self;
    
    self.navItem.title = self.title;
    
    
    self.navBar.tintColor = [UIColor grayColor];
    self.navBar.titleTextAttributes = @{NSForegroundColorAttributeName:BlueColor};
    
    
    
    //使scrollview可以上下滑动
    [self.view.subviews enumerateObjectsUsingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if ([obj isKindOfClass:[UIScrollView class]] && ![obj isKindOfClass:[UITableView class]]) {
            UIScrollView *sc = obj;
            UIView *v = sc.subviews.lastObject;
            CGFloat h = v.bottom+10;
            if (h<sc.height) {
                h = sc.height+1;
            }
            sc.contentSize = CGSizeMake(sc.width, h);
        }
    }];
    
    self.navigationController.navigationBar.hidden = YES;

    self.mainDataSource  = [NSMutableArray array];
    
    [self loadNetData];
}

-(void)refreshHeaderData{
    self.page = 1;
    [self loadNetData];
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        
        if ([self.mainTableView.mj_header isRefreshing]) {
            [self.mainTableView.mj_header endRefreshing];
            
        }
        if ([self.mainTableView.mj_footer isRefreshing]) {
            [self.mainTableView.mj_footer endRefreshing];
            
        }
    });
    
}
-(BOOL)textFieldShouldReturn:(UITextField *)textField{
    
    [self.view endEditing:YES];
    
    return YES;
}
-(void)endE:(UITapGestureRecognizer *)tap{
    [self.view endEditing:YES];
    
}
-(void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event{
    [self.view endEditing:YES];
    
}
-(NSMutableArray *)mainDataSource{
    if (!_mainDataSource) {
        _mainDataSource = [NSMutableArray array];
    }
    return _mainDataSource;
    
}

-(BOOL)hidesBottomBarWhenPushed{
    
    if ([self isKindOfClass:NSClassFromString(@"HomeViewController")] || [self isKindOfClass:NSClassFromString(@"WodeViewController")] ||[self isKindOfClass:NSClassFromString(@"ZuoXiDZHome")] ||[self isKindOfClass:NSClassFromString(@"QiangpiaoFSHomeVc")] ) {
        return NO;
    }else{
        return YES;
    }
}
-(UIViewController *)getVCInBoard:(NSString *)bord ID:(NSString *)idd{
    @try {
        if (!bord) {
            bord = @"Main";
        }
        UIStoryboard *story = [UIStoryboard storyboardWithName:bord bundle:nil];
        UIViewController *vc = [story instantiateViewControllerWithIdentifier:idd];
        
        return vc;
        
    } @catch (NSException *exception) {
        NSLog(@"无对应的控制器board  %@ ,identify:%@",bord,idd);
        return [[UIViewController alloc]init];
    } @finally {
        
    }
    
}
-(void)loadNetData{
    
}








#pragma mark - 自定义导航条
- (void)setNavBar {
    
    self.navBar = [[UINavigationBar alloc] initWithFrame:CGRectMake(0, 0, SWIDTH, 64.0)];
    self.navBar.translucent = NO;
    
    self.navItem = [[UINavigationItem alloc] init];
    [self.navBar setItems:@[self.navItem]];
    
    if ([[self.navigationController viewControllers] count] == 1) {
        
    } else {
        UIBarButtonItem *backBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"back-arrow"] style:UIBarButtonItemStylePlain target:self action:@selector(backAction)];
        self.navItem.leftBarButtonItem = backBarButtonItem;
    }
}

#pragma mark - Set方法

- (void)setTitle:(NSString *)title {
    self.navItem.title = title;
}

#pragma mark - 自定义方法

//返回
- (void)backAction {
//    timeout = -1;
    [self.navigationController popViewControllerAnimated:YES];
    
}
- (void)viewWillDisappear:(BOOL)animated {
    [super viewWillDisappear:animated];
    
    //显示系统导航条
    [self.navigationController setNavigationBarHidden:NO];
//    [JHHJView hideLoading]; //结束加载
}
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    
    //隐藏系统导航条
    [self.navigationController setNavigationBarHidden:YES];
    [self.view addSubview:self.navBar];
    
    if (!self.isPanForbid) { //默认开启
        // 开启iOS自带侧滑返回手势
        if ([self.navigationController respondsToSelector:@selector(interactivePopGestureRecognizer)]) {
            self.navigationController.interactivePopGestureRecognizer.enabled = YES;
        }
    } else {
        // 禁用iOS自带侧滑返回手势
        if ([self.navigationController respondsToSelector:@selector(interactivePopGestureRecognizer)]) {
            self.navigationController.interactivePopGestureRecognizer.enabled = NO;
        }
    }
}

- (void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];
    
    [self.view bringSubviewToFront:self.navBar];
}

- (IBAction)backAction:(UIButton *)sender {
    [self.navigationController popViewControllerAnimated:YES];
    
}
@end
